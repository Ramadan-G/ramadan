<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan 2026</title>
    <style>
        /* Stilet ekzistuese (nga versioni i m√´parsh√´m) - t√´ pandryshuara */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: #faf7f2;
            color: #5d4037;
            padding: 20px 16px 40px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Stili p√´r login */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(250, 247, 242, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .login-card {
            background: white;
            border-radius: 32px;
            padding: 32px 24px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(179, 94, 58, 0.2);
            border: 1px solid #f5e1d4;
            text-align: center;
        }

        .login-card h2 {
            color: #b35e3a;
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .login-card p {
            color: #8b6250;
            margin-bottom: 24px;
        }

        .login-input {
            width: 100%;
            background: #fffaf5;
            border: 2px solid #ecd9c9;
            border-radius: 50px;
            padding: 16px 24px;
            font-size: 1.1rem;
            margin-bottom: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .login-input:focus {
            border-color: #e6b17e;
        }

        .login-btn {
            background: #e6b17e;
            border: none;
            border-radius: 50px;
            padding: 16px 32px;
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 8px 16px rgba(230,177,126,0.3);
            transition: 0.1s;
        }

        .login-btn:active {
            transform: scale(0.98);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .title h1 {
            font-size: 2.2rem;
            font-weight: 400;
            color: #b35e3a;
            letter-spacing: 0.5px;
        }

        .title span {
            font-size: 2.4rem;
        }

        .user-greeting {
            background: #fcf3ea;
            padding: 8px 16px;
            border-radius: 40px;
            font-weight: 500;
            color: #b35e3a;
            border: 1px solid #f5d7b3;
            font-size: 0.95rem;
        }

        .day-control {
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            padding: 5px 15px;
            border-radius: 40px;
            border: 1px solid #f0dccc;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.02);
        }

        .day-btn {
            background: #e6b17e;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(230, 177, 126, 0.4);
        }

        .day-btn:active {
            transform: scale(0.95);
        }

        .day-display {
            font-weight: 600;
            font-size: 1.2rem;
            color: #7b5e4b;
            min-width: 70px;
            text-align: center;
        }

        .card {
            background: white;
            border-radius: 32px;
            padding: 24px 20px;
            margin-bottom: 24px;
            box-shadow: 0 10px 25px rgba(229, 198, 170, 0.15);
            border: 1px solid #f5e1d4;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.6rem;
            font-weight: 500;
            color: #b95b36;
            margin-bottom: 20px;
            border-bottom: 2px solid #f5e1d4;
            padding-bottom: 12px;
        }

        .card-header span {
            font-size: 2rem;
        }

        .salah-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #faefe7;
        }

        .salah-name {
            font-weight: 500;
            font-size: 1.1rem;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            accent-color: #e6b17e;
            border-radius: 6px;
        }

        .sunnah-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #faefe7;
        }

        .sunnah-name {
            font-weight: 500;
            font-size: 1rem;
        }

        .sunnah-choice {
            display: flex;
            gap: 12px;
        }

        .choice-btn {
            background: transparent;
            border: 2px solid #ecd9c9;
            border-radius: 40px;
            padding: 8px 24px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #5d4037;
            cursor: pointer;
            transition: 0.1s;
            min-width: 70px;
        }

        .choice-btn.active-yes {
            background: #e6b17e;
            border-color: #e6b17e;
            color: white;
        }

        .choice-btn.active-no {
            background: #d0b7a8;
            border-color: #b3927e;
            color: white;
        }

        .rakat-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 16px 0;
            background: #fef9f4;
            padding: 8px 16px;
            border-radius: 50px;
            border: 1px solid #f5d7b3;
        }

        .rakat-label {
            font-weight: 500;
        }

        .rakat-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .rakat-btn {
            background: #e6b17e;
            border: none;
            width: 42px;
            height: 42px;
            border-radius: 42px;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(230, 177, 126, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rakat-num {
            font-size: 1.5rem;
            font-weight: 500;
            min-width: 40px;
            text-align: center;
        }

        .dhikr-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 6px;
        }

        .dhikr-item {
            background: #fefaf5;
            border-radius: 60px;
            padding: 8px 16px 8px 22px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #f5dccf;
        }

        .dhikr-name {
            font-size: 0.95rem;
            font-weight: 500;
            max-width: 240px;
        }

        .dhikr-counter {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dhikr-counter span {
            font-size: 1.2rem;
            font-weight: 600;
            min-width: 45px;
            text-align: center;
        }

        .dhikr-plus {
            background: #e6b17e;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 40px;
            font-size: 1.8rem;
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(230,177,126,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-input-group {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            background: #fef7f0;
            padding: 16px;
            border-radius: 50px;
        }

        .page-input-group label {
            font-weight: 500;
        }

        .page-input-group input {
            background: white;
            border: 1px solid #e6cebc;
            border-radius: 40px;
            padding: 12px 18px;
            width: 90px;
            text-align: center;
            font-size: 1rem;
        }

        .progress-bg {
            background: #edd7c5;
            height: 16px;
            border-radius: 30px;
            width: 100%;
            margin: 16px 0 6px;
        }

        .progress-fill {
            background: #e6b17e;
            height: 16px;
            border-radius: 30px;
            width: 7%;
        }

        .field {
            margin: 22px 0;
        }

        .field label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #8b6250;
        }

        .field input, .field textarea {
            width: 100%;
            background: #fffaf5;
            border: 1px solid #ecd9c9;
            border-radius: 30px;
            padding: 16px 20px;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
        }

        .save-btn {
            background: #e6b17e;
            border: none;
            border-radius: 50px;
            padding: 16px 32px;
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(230,177,126,0.3);
            width: 100%;
            margin-top: 10px;
            transition: 0.1s;
        }

        .save-btn:active {
            transform: scale(0.98);
        }

        .stat-row {
            background: #fcf3ea;
            border-radius: 30px;
            padding: 14px 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            border: 1px solid #f5d7b3;
        }

        .footer {
            text-align: center;
            color: #aa8a76;
            font-size: 0.9rem;
            margin: 30px 0 10px;
        }

        .location-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .location-badge {
            background: #fefaf5;
            padding: 8px 16px;
            border-radius: 40px;
            border: 1px solid #f5dccf;
            font-weight: 500;
        }
        .next-badge {
            background: #e6b17e;
            color: white;
            padding: 8px 16px;
            border-radius: 40px;
            font-weight: 500;
        }
        .sunrise-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .info-badge {
            background: #fcf3ea;
            padding: 8px 16px;
            border-radius: 40px;
            border: 1px solid #f5d7b3;
        }
        .prayer-icons {
            display: flex;
            gap: 6px;
            justify-content: space-between;
        }
        .prayer-icon-item {
            flex: 1;
            text-align: center;
            background: #fefaf5;
            border-radius: 30px;
            padding: 8px 0;
            border: 1px solid #f5dccf;
            font-size: 0.9rem;
        }
        .prayer-icon-item strong {
            font-size: 1rem;
            display: block;
        }

        /* Stili p√´r kartel√´n e reklam√´s */
        .ad-card {
            background: #fff3e9;
            border: 2px solid #e6b17e;
            text-align: center;
        }
        .ad-title {
            font-size: 2rem;
            font-weight: 600;
            color: #b35e3a;
            margin-bottom: 4px;
        }
        .ad-subtitle {
            font-size: 1.2rem;
            font-style: italic;
            color: #8b6250;
            margin-bottom: 16px;
        }
        .ad-description {
            background: #fefaf5;
            border-radius: 30px;
            padding: 16px;
            margin: 16px 0;
            border: 1px solid #f5d7b3;
        }
        .ad-contact {
            background: #e6b17e;
            color: white;
            border-radius: 50px;
            padding: 16px;
            margin: 16px 0;
        }
        .ad-contact p {
            margin: 4px 0;
        }
        .ad-phone {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .ad-weight {
            font-size: 2.2rem;
            font-weight: 700;
            color: #b35e3a;
            margin: 16px 0 8px;
        }
        .ad-social {
            background: #fcf3ea;
            border-radius: 40px;
            padding: 12px;
            border: 1px solid #f5d7b3;
            margin: 16px 0;
        }
        .ad-footer {
            font-size: 1.3rem;
            font-weight: 600;
            color: #b35e3a;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <!-- Login overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-card">
            <h2>üåô Ramadan 2026</h2>
            <p>Shkruaj emrin t√´nd p√´r t√´ vazhduar</p>
            <input type="text" id="usernameInput" class="login-input" placeholder="Emri yt" autocomplete="off">
            <button class="login-btn" onclick="saveUsername()">Fillo</button>
        </div>
    </div>

    <div class="app" id="mainApp" style="display: none;">
        <!-- Header me emrin e p√´rdoruesit dhe kontrollin e dit√´ve -->
        <div class="header">
            <div class="title">
                <span>üåô</span>
                <h1>Ramadan 2026</h1>
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <span class="user-greeting" id="userGreeting"></span>
                <div class="day-control">
                    <button class="day-btn" onclick="changeDayManually(-1)">‚àí</button>
                    <span class="day-display" id="currentDay">Duke marr√´...</span>
                    <button class="day-btn" onclick="changeDayManually(1)">+</button>
                </div>
            </div>
        </div>

        <!-- Karta e orareve -->
        <div class="card">
            <div class="card-header"><span>‚è∞</span> Koha e namazeve</div>
            <div class="location-row">
                <div class="location-badge" id="locationDisplay">
                    <span>üìç</span> Duke marr√´ vendndodhjen...
                </div>
                <div class="next-badge" id="nextPrayerText">
                    Duke llogaritur...
                </div>
            </div>
            <div class="sunrise-row">
                <div class="info-badge">
                    üåÖ Lindja e diellit: <strong id="sunriseTime">--:--</strong>
                </div>
                <div class="info-badge">
                    üìÖ <span id="hijriDate">Duke marr√´...</span>
                </div>
            </div>
            <div class="prayer-icons" id="prayerIconsContainer"></div>
        </div>

        <!-- Karta e Namazeve -->
        <div class="card">
            <div class="card-header"><span>üïå</span> Namazet</div>

            <!-- 5 obligative -->
            <div class="salah-row">
                <span class="salah-name">Sabah</span> 
                <input type="checkbox" id="farzSabah" onchange="saveCurrentDayData()">
            </div>
            <div class="salah-row">
                <span class="salah-name">Dreka</span> 
                <input type="checkbox" id="farzDreka" onchange="saveCurrentDayData()">
            </div>
            <div class="salah-row">
                <span class="salah-name">Ikindia</span> 
                <input type="checkbox" id="farzIkindia" onchange="saveCurrentDayData()">
            </div>
            <div class="salah-row">
                <span class="salah-name">Aksham</span> 
                <input type="checkbox" id="farzAksham" onchange="saveCurrentDayData()">
            </div>
            <div class="salah-row">
                <span class="salah-name">Jacia</span> 
                <input type="checkbox" id="farzJacia" onchange="saveCurrentDayData()">
            </div>

            <!-- Sunetet -->
            <div style="margin: 24px 0 8px; font-weight:600; color:#b95b36;">Sunetet (zgjidh p√´r secilin)</div>

            <!-- Sabah 2 -->
            <div class="sunnah-row">
                <span class="sunnah-name">Sabah (2 rekate)</span>
                <div class="sunnah-choice" id="sunnahSabah">
                    <button class="choice-btn" data-choice="yes" onclick="setSunnah('sabah', 'yes')">‚úì</button>
                    <button class="choice-btn" data-choice="no" onclick="setSunnah('sabah', 'no')">‚úó</button>
                </div>
            </div>

            <!-- Dreka 4+2 -->
            <div class="sunnah-row">
                <span class="sunnah-name">Dreka (4+2 rekate)</span>
                <div class="sunnah-choice" id="sunnahDreka">
                    <button class="choice-btn" data-choice="yes" onclick="setSunnah('dreka', 'yes')">‚úì</button>
                    <button class="choice-btn" data-choice="no" onclick="setSunnah('dreka', 'no')">‚úó</button>
                </div>
            </div>

            <!-- Ikindia 4 -->
            <div class="sunnah-row">
                <span class="sunnah-name">Ikindia (4 rekate)</span>
                <div class="sunnah-choice" id="sunnahIkindia">
                    <button class="choice-btn" data-choice="yes" onclick="setSunnah('ikindia', 'yes')">‚úì</button>
                    <button class="choice-btn" data-choice="no" onclick="setSunnah('ikindia', 'no')">‚úó</button>
                </div>
            </div>

            <!-- Aksham 2 -->
            <div class="sunnah-row">
                <span class="sunnah-name">Aksham (2 rekate)</span>
                <div class="sunnah-choice" id="sunnahAksham">
                    <button class="choice-btn" data-choice="yes" onclick="setSunnah('aksham', 'yes')">‚úì</button>
                    <button class="choice-btn" data-choice="no" onclick="setSunnah('aksham', 'no')">‚úó</button>
                </div>
            </div>

            <!-- Jacia 4+2 -->
            <div class="sunnah-row">
                <span class="sunnah-name">Jacia (4+2 rekate)</span>
                <div class="sunnah-choice" id="sunnahJacia">
                    <button class="choice-btn" data-choice="yes" onclick="setSunnah('jacia', 'yes')">‚úì</button>
                    <button class="choice-btn" data-choice="no" onclick="setSunnah('jacia', 'no')">‚úó</button>
                </div>
            </div>

            <!-- Namazet vullnetare -->
            <div style="margin: 24px 0 8px; font-weight:600; color:#b95b36;">Namazet vullnetare</div>

            <!-- Duha -->
            <div class="rakat-selector">
                <span class="rakat-label">Duha</span>
                <div class="rakat-controls">
                    <button class="rakat-btn" onclick="changeRakat('duha', -1)">‚àí</button>
                    <span class="rakat-num" id="duhaRakat">0</span>
                    <button class="rakat-btn" onclick="changeRakat('duha', 1)">+</button>
                </div>
            </div>

            <!-- Teravi -->
            <div class="rakat-selector">
                <span class="rakat-label">Teravi</span>
                <div class="rakat-controls">
                    <button class="rakat-btn" onclick="changeRakat('teravi', -1)">‚àí</button>
                    <span class="rakat-num" id="teraviRakat">0</span>
                    <button class="rakat-btn" onclick="changeRakat('teravi', 1)">+</button>
                </div>
            </div>

            <!-- Namaz nate -->
            <div class="rakat-selector">
                <span class="rakat-label">Namaz nate</span>
                <div class="rakat-controls">
                    <button class="rakat-btn" onclick="changeRakat('nate', -1)">‚àí</button>
                    <span class="rakat-num" id="nateRakat">0</span>
                    <button class="rakat-btn" onclick="changeRakat('nate', 1)">+</button>
                </div>
            </div>

            <!-- Namaz nafile -->
            <div class="rakat-selector" style="margin-top: 20px;">
                <span class="rakat-label">Namaz nafile (t√´ tjera)</span>
                <div class="rakat-controls">
                    <button class="rakat-btn" onclick="changeRakat('nafile', -1)">‚àí</button>
                    <span class="rakat-num" id="nafileRakat">0</span>
                    <button class="rakat-btn" onclick="changeRakat('nafile', 1)">+</button>
                </div>
            </div>
        </div>

        <!-- Karta e 16 lutjeve (Dhikr) -->
        <div class="card">
            <div class="card-header"><span>üìø</span> Lutjet (Dhikr)</div>
            <div class="dhikr-list" id="dhikrContainer"></div>
            <button class="save-btn" style="margin-top: 20px;" onclick="resetAllDhikr()">Rivendos t√´ gjitha n√´ 0</button>
        </div>

        <!-- Kur'ani -->
        <div class="card">
            <div class="card-header"><span>üìñ</span> Kur'ani (faqe)</div>
            <div class="page-input-group">
                <label>Nga:</label>
                <input type="number" id="fromPage" value="1" min="1" max="604" onchange="saveCurrentDayData()">
                <label>n√´:</label>
                <input type="number" id="toPage" value="1" min="1" max="604" onchange="saveCurrentDayData()">
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight:500;">Sot: <span id="todayPages">0</span> faqe</span>
                <button class="save-btn" style="width:auto; padding:12px 24px;" onclick="calculatePages()">Ruaj</button>
            </div>
            <div style="margin-top: 24px;">
                <span>Gjithsej n√´ muaj: <span id="totalPagesMonth">0</span> / 604 faqe</span>
                <div class="progress-bg"><div class="progress-fill" id="quranProgress" style="width:0%"></div></div>
            </div>
        </div>

        <!-- Kontrolli ditor -->
        <div class="card">
            <div class="card-header"><span>‚è∞</span> Kontrolli ditor</div>
            <div class="field">
                <label>üì± Koha n√´ tel/TV (minuta)</label>
                <input type="number" id="screenTime" value="0" placeholder="minuta" onchange="saveCurrentDayData()">
            </div>
            <div class="field">
                <label>üí∞ Sadaka (‚Ç¨)</label>
                <input type="number" id="sadaka" value="0" step="0.5" placeholder="shuma" onchange="saveCurrentDayData()">
            </div>
            <div class="field">
                <label>ü§≤ Lutja e dit√´s</label>
                <textarea id="dailyDua" rows="2" onchange="saveCurrentDayData()">O Allah, m√´ jep forc√´ dhe durim k√´t√´ dit√´</textarea>
            </div>
            <div class="field">
                <label>üìù Reflektimi ditor</label>
                <textarea id="dailyReflection" rows="2" onchange="saveCurrentDayData()"></textarea>
            </div>
            <button class="save-btn" onclick="saveCurrentDayData()">Ruaj t√´ dh√´nat</button>
        </div>

        <!-- Karta e reklam√´s me foton tuaj -->
        <div class="card ad-card">
            <img src="https://i.postimg.cc/FKDPHG2b/IMG-20260219-WA0000.jpg" alt="Hurme Sukeri" style="width:100%; border-radius:24px; margin-bottom:16px; border:2px solid #e6b17e;">
            <div class="ad-title">Hurme Sukeri</div>
            <div class="ad-subtitle">Shije q√´ nuk harrohet!</div>
            <div class="ad-description">
                T√´ √´mbla, t√´ buta dhe super t√´ fresk√´ta.<br>
                Perfekte p√´r familje, mysafir√´ dhe √ßdo tryez√´.
            </div>
            <div class="ad-contact">
                <p style="font-weight:600;">Shesim me shumic√´ & pakic√´</p>
                <p><strong>Porosit tani:</strong></p>
                <p class="ad-phone">üìû 045 669 151</p>
                <p class="ad-phone">üìû 045 921 578</p>
            </div>
            <div class="ad-weight">3 Kg</div>
            <div class="ad-social">
                Na shkruani n√´ Viber, WhatsApp, Instagram & Facebook.
            </div>
            <div class="ad-footer">
                HURME TAZE
            </div>
            <p style="color:#8b6250; margin-top:8px;">Cil√´si, freski dhe besim!</p>
        </div>

        <div class="footer">üåô √ádo dit√´ √´sht√´ mund√´si</div>
    </div>

    <script>
        // Lista e 16 lutjeve
        const dhikrList = [
            "Subhanallah (100x)", "Elhamdulilah (100x)", "Allahu Ekber (100x)", "Estagfirullah (100x)",
            "La ilahe illallah, Muhamedun Resulullah", "SubhanAllahi ve bi hamdihi",
            "SubhanAllahi ve bi hamdihi, SubhanAllahil Adhim", "HasbijAllahu ve ni‚Äômel vekil",
            "La hawle ve la kuvvete illa billah", "Salavatet",
            "La ilahe illallah wahdehu la sherike leh, lehul mulku we lehul hamdu we huwe ala kuli shejin kadir",
            "Estagfirullah ve etubu ilejh", "Allahumme inni es‚Äôeluke‚Äôl xhenneh we eudhu bike mine nar (7x)",
            "Ihlas 13her", "La ilahe illa ente subhaneke inni kuntu mine dhalimin",
            "Hasbijallahu la ilahe ila huve, alejhi tevekeltu ve huve rabbul arshil adhim"
        ];

        // Variablat kryesore
        let currentDay = 1;
        let totalDaysInMonth = 30;
        let userName = '';
        let userCoords = null;
        let prayerTimes = [];
        let sunriseTimeStr = '--:--';

        // Funksionet p√´r login dhe GPS
        function saveUsername() {
            const input = document.getElementById('usernameInput');
            const name = input.value.trim();
            if (name) {
                userName = name;
                document.getElementById('userGreeting').innerText = `üë§ ${name}`;
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                localStorage.setItem('ramadanUser', name);
                getLocation();
            } else {
                alert('Ju lutem shkruani emrin tuaj');
            }
        }

        (function() {
            const savedUser = localStorage.getItem('ramadanUser');
            if (savedUser) {
                userName = savedUser;
                document.getElementById('userGreeting').innerText = `üë§ ${savedUser}`;
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                getLocation();
            }
        })();

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                document.getElementById('locationDisplay').innerHTML = 'üìç Geolokacioni nuk mb√´shtetet';
                useFallbackTimes();
            }
        }

        function showPosition(position) {
            userCoords = {
                lat: position.coords.latitude,
                lon: position.coords.longitude
            };
            
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${userCoords.lat}&lon=${userCoords.lon}`)
                .then(response => response.json())
                .then(data => {
                    const city = data.address.city || data.address.town || data.address.village || 'vendndodhja juaj';
                    document.getElementById('locationDisplay').innerHTML = `üìç ${city}`;
                })
                .catch(() => {
                    document.getElementById('locationDisplay').innerHTML = 'üìç Vendndodhja juaj';
                });

            fetch(`https://api.aladhan.com/v1/timings?latitude=${userCoords.lat}&longitude=${userCoords.lon}&method=13`)
                .then(response => response.json())
                .then(data => {
                    const timings = data.data.timings;
                    const hijri = data.data.date.hijri;
                    
                    prayerTimes = [
                        { name: 'Sabah', time: timings.Fajr },
                        { name: 'Dreka', time: timings.Dhuhr },
                        { name: 'Ikindia', time: timings.Asr },
                        { name: 'Aksham', time: timings.Maghrib },
                        { name: 'Jacia', time: timings.Isha }
                    ];
                    
                    sunriseTimeStr = timings.Sunrise;
                    
                    totalDaysInMonth = hijri.month.days || 30;
                    currentDay = parseInt(hijri.day) || 1;
                    if (currentDay > totalDaysInMonth) currentDay = totalDaysInMonth;
                    
                    const hijriDateStr = `${hijri.day} ${hijri.month.ar} ${hijri.year}`;
                    document.getElementById('hijriDate').innerText = hijriDateStr;
                    
                    document.getElementById('currentDay').innerText = `Dita ${currentDay}/${totalDaysInMonth}`;
                    
                    loadDayData(currentDay);
                    
                    document.getElementById('sunriseTime').innerText = sunriseTimeStr;
                    updatePrayerCard();
                })
                .catch(error => {
                    console.error('Error fetching prayer times:', error);
                    useFallbackTimes();
                });
        }

        function showError(error) {
            let msg = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    msg = "P√´rdoruesi nuk e lejoi k√´rkes√´n p√´r lokacion.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    msg = "Informacioni i lokacionit nuk √´sht√´ i disponuesh√´m.";
                    break;
                case error.TIMEOUT:
                    msg = "K√´rkesa p√´r lokacion u skadua.";
                    break;
            }
            document.getElementById('locationDisplay').innerHTML = `üìç ${msg}`;
            useFallbackTimes();
        }

        function useFallbackTimes() {
            prayerTimes = [
                { name: 'Sabah', time: '05:40' },
                { name: 'Dreka', time: '12:43' },
                { name: 'Ikindia', time: '15:19' },
                { name: 'Aksham', time: '17:53' },
                { name: 'Jacia', time: '19:30' }
            ];
            sunriseTimeStr = '06:48';
            totalDaysInMonth = 30;
            currentDay = 1;
            
            document.getElementById('currentDay').innerText = `Dita ${currentDay}/${totalDaysInMonth}`;
            document.getElementById('sunriseTime').innerText = sunriseTimeStr;
            document.getElementById('hijriDate').innerText = '29 Sha\'ban 1447';
            
            loadDayData(currentDay);
            updatePrayerCard();
        }

        // Funksionet p√´r ruajtjen dhe ngarkimin e t√´ dh√´nave p√´r √ßdo dit√´
        function getEmptyDayData() {
            return {
                farz: { sabah: false, dreka: false, ikindia: false, aksham: false, jacia: false },
                sunnah: { sabah: 'yes', dreka: 'yes', ikindia: 'yes', aksham: 'no', jacia: 'no' },
                rakat: { duha: 0, teravi: 0, nate: 0, nafile: 0 },
                dhikr: new Array(16).fill(0),
                quran: { fromPage: 1, toPage: 1 },
                daily: { screenTime: 0, sadaka: 0, dua: "O Allah, m√´ jep forc√´ dhe durim k√´t√´ dit√´", reflection: "" }
            };
        }

        function saveCurrentDayData() {
            if (!currentDay) return;
            
            const dayData = getEmptyDayData();
            
            dayData.farz.sabah = document.getElementById('farzSabah').checked;
            dayData.farz.dreka = document.getElementById('farzDreka').checked;
            dayData.farz.ikindia = document.getElementById('farzIkindia').checked;
            dayData.farz.aksham = document.getElementById('farzAksham').checked;
            dayData.farz.jacia = document.getElementById('farzJacia').checked;
            
            dayData.sunnah.sabah = getSunnahValue('sunnahSabah');
            dayData.sunnah.dreka = getSunnahValue('sunnahDreka');
            dayData.sunnah.ikindia = getSunnahValue('sunnahIkindia');
            dayData.sunnah.aksham = getSunnahValue('sunnahAksham');
            dayData.sunnah.jacia = getSunnahValue('sunnahJacia');
            
            dayData.rakat.duha = parseInt(document.getElementById('duhaRakat').innerText) || 0;
            dayData.rakat.teravi = parseInt(document.getElementById('teraviRakat').innerText) || 0;
            dayData.rakat.nate = parseInt(document.getElementById('nateRakat').innerText) || 0;
            dayData.rakat.nafile = parseInt(document.getElementById('nafileRakat').innerText) || 0;
            
            for (let i = 0; i < 16; i++) {
                const span = document.getElementById(`dhikr-${i}`);
                if (span) dayData.dhikr[i] = parseInt(span.innerText) || 0;
            }
            
            dayData.quran.fromPage = parseInt(document.getElementById('fromPage').value) || 1;
            dayData.quran.toPage = parseInt(document.getElementById('toPage').value) || 1;
            
            dayData.daily.screenTime = parseInt(document.getElementById('screenTime').value) || 0;
            dayData.daily.sadaka = parseFloat(document.getElementById('sadaka').value) || 0;
            dayData.daily.dua = document.getElementById('dailyDua').value;
            dayData.daily.reflection = document.getElementById('dailyReflection').value;
            
            localStorage.setItem(`ramadan_day_${currentDay}`, JSON.stringify(dayData));
            calculatePages();
        }

        function getSunnahValue(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return 'yes';
            const yesBtn = container.querySelector('.choice-btn.active-yes');
            return yesBtn ? 'yes' : 'no';
        }

        function loadDayData(day) {
            const saved = localStorage.getItem(`ramadan_day_${day}`);
            let dayData = saved ? JSON.parse(saved) : getEmptyDayData();
            
            document.getElementById('farzSabah').checked = dayData.farz.sabah;
            document.getElementById('farzDreka').checked = dayData.farz.dreka;
            document.getElementById('farzIkindia').checked = dayData.farz.ikindia;
            document.getElementById('farzAksham').checked = dayData.farz.aksham;
            document.getElementById('farzJacia').checked = dayData.farz.jacia;
            
            setSunnahUI('sunnahSabah', dayData.sunnah.sabah);
            setSunnahUI('sunnahDreka', dayData.sunnah.dreka);
            setSunnahUI('sunnahIkindia', dayData.sunnah.ikindia);
            setSunnahUI('sunnahAksham', dayData.sunnah.aksham);
            setSunnahUI('sunnahJacia', dayData.sunnah.jacia);
            
            document.getElementById('duhaRakat').innerText = dayData.rakat.duha || 0;
            document.getElementById('teraviRakat').innerText = dayData.rakat.teravi || 0;
            document.getElementById('nateRakat').innerText = dayData.rakat.nate || 0;
            document.getElementById('nafileRakat').innerText = dayData.rakat.nafile || 0;
            
            for (let i = 0; i < 16; i++) {
                const span = document.getElementById(`dhikr-${i}`);
                if (span) span.innerText = dayData.dhikr[i] || 0;
            }
            
            document.getElementById('fromPage').value = dayData.quran.fromPage || 1;
            document.getElementById('toPage').value = dayData.quran.toPage || 1;
            
            document.getElementById('screenTime').value = dayData.daily.screenTime || 0;
            document.getElementById('sadaka').value = dayData.daily.sadaka || 0;
            document.getElementById('dailyDua').value = dayData.daily.dua || "O Allah, m√´ jep forc√´ dhe durim k√´t√´ dit√´";
            document.getElementById('dailyReflection').value = dayData.daily.reflection || "";
            
            calculatePages();
        }

        function setSunnahUI(containerId, value) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const btns = container.querySelectorAll('.choice-btn');
            btns.forEach(btn => {
                btn.classList.remove('active-yes', 'active-no');
                if (btn.dataset.choice === value) {
                    btn.classList.add(value === 'yes' ? 'active-yes' : 'active-no');
                }
            });
        }

        function setSunnah(prayer, value) {
            const containerId = 'sunnah' + prayer.charAt(0).toUpperCase() + prayer.slice(1);
            setSunnahUI(containerId, value);
            saveCurrentDayData();
        }

        function changeDayManually(delta) {
            let newDay = currentDay + delta;
            if (newDay < 1) newDay = 1;
            if (newDay > totalDaysInMonth) newDay = totalDaysInMonth;
            
            if (newDay !== currentDay) {
                saveCurrentDayData();
                currentDay = newDay;
                document.getElementById('currentDay').innerText = `Dita ${currentDay}/${totalDaysInMonth}`;
                loadDayData(currentDay);
            }
        }

        function changeRakat(which, delta) {
            const el = document.getElementById(which + 'Rakat');
            let val = parseInt(el.innerText) || 0;
            val += delta;
            if (val < 0) val = 0;
            if (which === 'duha' && val > 24) val = 24;
            if (which === 'teravi' && val > 100) val = 100;
            if (which === 'nate' && val > 20) val = 20;
            if (which === 'nafile' && val > 100) val = 100;
            el.innerText = val;
            saveCurrentDayData();
        }

        function calculatePages() {
            const from = parseInt(document.getElementById('fromPage').value) || 1;
            const to = parseInt(document.getElementById('toPage').value) || 1;
            if (to >= from) {
                const pagesToday = to - from;
                document.getElementById('todayPages').innerText = pagesToday;
                
                let totalPages = 0;
                for (let d = 1; d <= currentDay; d++) {
                    const saved = localStorage.getItem(`ramadan_day_${d}`);
                    if (saved) {
                        const data = JSON.parse(saved);
                        if (data.quran && data.quran.toPage && data.quran.fromPage) {
                            totalPages += (data.quran.toPage - data.quran.fromPage);
                        }
                    }
                }
                document.getElementById('totalPagesMonth').innerText = totalPages;
                
                const percent = Math.min(100, Math.round((totalPages / 604) * 100));
                document.getElementById('quranProgress').style.width = percent + '%';
            }
            saveCurrentDayData();
        }

        function renderDhikr() {
            const container = document.getElementById('dhikrContainer');
            container.innerHTML = '';
            dhikrList.forEach((text, index) => {
                const item = document.createElement('div');
                item.className = 'dhikr-item';
                item.innerHTML = `
                    <span class="dhikr-name">${index+1}. ${text}</span>
                    <div class="dhikr-counter">
                        <span id="dhikr-${index}">0</span>
                        <button class="dhikr-plus" onclick="increaseDhikr(${index})">+</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function increaseDhikr(index) {
            const span = document.getElementById(`dhikr-${index}`);
            let val = parseInt(span.innerText) || 0;
            span.innerText = val + 1;
            saveCurrentDayData();
        }

        function resetAllDhikr() {
            for (let i = 0; i < dhikrList.length; i++) {
                const span = document.getElementById(`dhikr-${i}`);
                if (span) span.innerText = '0';
            }
            saveCurrentDayData();
        }

        function getCurrentMinutes() {
            const now = new Date();
            return now.getHours() * 60 + now.getMinutes();
        }

        function timeToMinutes(timeStr) {
            const [h, m] = timeStr.split(':').map(Number);
            return h * 60 + m;
        }

        function formatDuration(min) {
            const h = Math.floor(min / 60);
            const m = min % 60;
            return `${h}h ${m}m`;
        }

        function updatePrayerCard() {
            if (prayerTimes.length === 0) return;

            const now = getCurrentMinutes();
            const prayerMins = prayerTimes.map(p => timeToMinutes(p.time));

            let nextIndex = prayerMins.findIndex(t => t > now);
            let timeUntil;
            if (nextIndex === -1) {
                nextIndex = 0;
                timeUntil = (24 * 60 - now) + prayerMins[0];
            } else {
                timeUntil = prayerMins[nextIndex] - now;
            }

            const nextPrayer = prayerTimes[nextIndex];
            document.getElementById('nextPrayerText').innerHTML = `${nextPrayer.name} p√´r ${formatDuration(timeUntil)}`;

            const container = document.getElementById('prayerIconsContainer');
            container.innerHTML = '';
            prayerTimes.forEach(p => {
                const div = document.createElement('div');
                div.className = 'prayer-icon-item';
                let emoji = 'üïå';
                if (p.name === 'Sabah') emoji = 'üåÖ';
                else if (p.name === 'Dreka') emoji = '‚òÄÔ∏è';
                else if (p.name === 'Ikindia') emoji = 'üåÜ';
                else if (p.name === 'Aksham') emoji = 'üåá';
                else if (p.name === 'Jacia') emoji = 'üåô';
                div.innerHTML = `${emoji} ${p.name}<br><strong>${p.time}</strong>`;
                container.appendChild(div);
            });
        }

        window.onload = function() {
            renderDhikr();
            if (!localStorage.getItem('ramadanUser')) {
                // Login shfaqet
            }
            setInterval(updatePrayerCard, 60000);
        };
    </script>
</body>
</html>
